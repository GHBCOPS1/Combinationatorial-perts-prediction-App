<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>scGPT - Single Cell Perturbation Predictor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2em;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
        }
        
        .sidebar {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            height: fit-content;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .main-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            min-height: 600px;
        }
        
        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            border: 2px dashed #667eea;
            border-radius: 12px;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #667eea;
            font-weight: 500;
        }
        
        .file-upload-label:hover {
            background: #eef1ff;
            transform: translateY(-2px);
        }
        
        .file-upload.has-file .file-upload-label {
            background: #e8f5e8;
            border-color: #28a745;
            color: #28a745;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }
        
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            text-align: center;
            margin-top: 8px;
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .results-container {
            margin-top: 30px;
            display: none;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .visualization-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .gene-heatmap {
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            gap: 2px;
            margin: 20px 0;
            max-width: 600px;
        }
        
        .gene-cell {
            width: 25px;
            height: 25px;
            border-radius: 3px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .gene-cell:hover {
            transform: scale(1.3);
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .prediction-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .prediction-table th,
        .prediction-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .prediction-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .prediction-table tr:hover {
            background: #f8f9ff;
        }
        
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #664d03;
            border: 1px solid #ffecb5;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 4px;
        }
        
        .tab-button {
            flex: 1;
            background: none;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .parameter-slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .slider-value {
            min-width: 50px;
            text-align: center;
            font-weight: 600;
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>üß¨ scGPT Perturbation Predictor</h1>
            <p>AI-powered single-cell transcriptomic perturbation prediction</p>
        </div>
        
        <div class="main-content">
            <!-- Sidebar Controls -->
            <div class="sidebar">
                <div class="section-title">
                    üìä Data Input
                </div>
                
                <div class="input-group">
                    <label>Upload Expression Data</label>
                    <div class="file-upload" id="expression-upload">
                        <input type="file" accept=".csv,.h5ad,.xlsx" id="expression-file">
                        <div class="file-upload-label">
                            üìÅ Choose file or drag & drop
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Perturbation Type</label>
                    <select id="perturbation-type">
                        <option value="knockout">üéØ Gene Knockout</option>
                        <option value="knockdown">üìâ Gene Knockdown</option>
                        <option value="overexpression">üìà Overexpression</option>
                        <option value="compound">üíä Chemical Perturbation</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Target Gene(s)</label>
                    <input type="text" id="target-genes" placeholder="e.g., TP53, MYC, BRCA1" 
                           title="Enter gene symbols separated by commas">
                </div>
                
                <div class="input-group">
                    <label>Cell Type (optional)</label>
                    <select id="cell-type">
                        <option value="">Auto-detect</option>
                        <option value="fibroblast">Fibroblast</option>
                        <option value="neuronal">Neuronal</option>
                        <option value="immune">Immune Cell</option>
                        <option value="epithelial">Epithelial</option>
                        <option value="stem">Stem Cell</option>
                    </select>
                </div>
                
                <div class="section-title">
                    ‚öôÔ∏è Model Parameters
                </div>
                
                <div class="input-group">
                    <label>Prediction Confidence</label>
                    <div class="slider-container">
                        <input type="range" class="parameter-slider" id="confidence-slider" 
                               min="0.1" max="1.0" step="0.1" value="0.8">
                        <span class="slider-value" id="confidence-value">0.8</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Number of Predictions</label>
                    <div class="slider-container">
                        <input type="range" class="parameter-slider" id="num-predictions" 
                               min="10" max="1000" step="10" value="300">
                        <span class="slider-value" id="num-predictions-value">300</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Effect Strength</label>
                    <div class="slider-container">
                        <input type="range" class="parameter-slider" id="effect-strength" 
                               min="0.1" max="2.0" step="0.1" value="1.0">
                        <span class="slider-value" id="effect-strength-value">1.0</span>
                    </div>
                </div>
                
                <button class="btn" id="predict-btn" onclick="runPrediction()">
                    üöÄ Run Prediction
                </button>
                
                <div class="progress-container" id="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" id="progress-text">Processing...</div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="loadSampleData()">
                        üìã Load Sample Data
                    </button>
                    <button class="btn btn-success" onclick="exportResults()" id="export-btn" style="margin-top: 10px;" disabled>
                        üíæ Export Results
                    </button>
                </div>
            </div>
            
            <!-- Main Panel -->
            <div class="main-panel">
                <div class="tabs">
                    <button class="tab-button active" onclick="switchTab('overview')">üìä Overview</button>
                    <button class="tab-button" onclick="switchTab('results')">üéØ Results</button>
                    <button class="tab-button" onclick="switchTab('analysis')">üìà Analysis</button>
                    <button class="tab-button" onclick="switchTab('export')">üíæ Export</button>
                </div>
                
                <!-- Overview Tab -->
                <div id="overview-tab" class="tab-content active">
                    <div class="section-title">
                        üè† Welcome to scGPT Predictor
                    </div>
                    
                    <div class="alert alert-success">
                        ‚úÖ <strong>Ready to predict!</strong> Upload your single-cell expression data to get started.
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìã How to Use</h3>
                        <ol style="line-height: 1.8; margin-left: 20px;">
                            <li><strong>Upload Data:</strong> Provide your single-cell expression matrix (.csv, .h5ad, or .xlsx)</li>
                            <li><strong>Select Perturbation:</strong> Choose the type of genetic perturbation to simulate</li>
                            <li><strong>Specify Targets:</strong> Enter the gene(s) you want to perturb</li>
                            <li><strong>Adjust Parameters:</strong> Fine-tune prediction parameters for your analysis</li>
                            <li><strong>Run Prediction:</strong> Let our AI model predict the perturbation effects</li>
                            <li><strong>Analyze Results:</strong> Explore the predicted expression changes and download results</li>
                        </ol>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üî¨ Model Information</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                            <div>
                                <strong>Architecture:</strong> Transformer-based<br>
                                <strong>Parameters:</strong> ~25M trainable<br>
                                <strong>Training Data:</strong> 50K+ cells<br>
                            </div>
                            <div>
                                <strong>Accuracy:</strong> 87.3%<br>
                                <strong>Genes Supported:</strong> 18,080<br>
                                <strong>Cell Types:</strong> Multiple<br>
                            </div>
                        </div>
                    </div>
                    
                    <div id="sample-data-info" style="display: none;">
                        <div class="alert alert-warning">
                            üìã Sample data loaded! This includes expression data for 1000 cells across key genes.
                        </div>
                    </div>
                </div>
                
                <!-- Results Tab -->
                <div id="results-tab" class="tab-content">
                    <div class="section-title">
                        üéØ Prediction Results
                    </div>
                    
                    <div class="results-container" id="results-container">
                        <div class="results-grid">
                            <div class="metric-card">
                                <div class="metric-label">Predictions Generated</div>
                                <div class="metric-value" id="num-predictions-result">0</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label">Genes Affected</div>
                                <div class="metric-value" id="genes-affected">0</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label">Avg Effect Size</div>
                                <div class="metric-value" id="avg-effect-size">0.0</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label">Confidence Score</div>
                                <div class="metric-value" id="confidence-score">0.0</div>
                            </div>
                        </div>
                        
                        <div class="visualization-container">
                            <h3>üß¨ Expression Heatmap</h3>
                            <p>Predicted gene expression changes (red = upregulated, blue = downregulated)</p>
                            <div class="gene-heatmap" id="gene-heatmap">
                                <!-- Generated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="visualization-container">
                            <h3>üìä Top Affected Genes</h3>
                            <table class="prediction-table" id="top-genes-table">
                                <thead>
                                    <tr>
                                        <th>Gene Symbol</th>
                                        <th>Fold Change</th>
                                        <th>P-value</th>
                                        <th>Effect</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="no-results" class="alert alert-warning">
                        ‚ö†Ô∏è No results yet. Run a prediction to see results here.
                    </div>
                </div>
                
                <!-- Analysis Tab -->
                <div id="analysis-tab" class="tab-content">
                    <div class="section-title">
                        üìà Analysis & Insights
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üéØ Perturbation Impact Analysis</h3>
                        <div id="impact-analysis">
                            <p>Run a prediction to see detailed impact analysis.</p>
                        </div>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üõ§Ô∏è Pathway Enrichment</h3>
                        <div id="pathway-analysis">
                            <p>Pathway analysis will appear after prediction completion.</p>
                        </div>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìä Statistical Summary</h3>
                        <div id="statistical-summary">
                            <p>Statistical insights will be generated from your prediction results.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Export Tab -->
                <div id="export-tab" class="tab-content">
                    <div class="section-title">
                        üíæ Export & Download
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìÑ Available Export Formats</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                            <button class="btn" onclick="exportFormat('csv')" id="export-csv">
                                üìä CSV Format
                            </button>
                            <button class="btn" onclick="exportFormat('h5ad')" id="export-h5ad">
                                üß¨ AnnData (H5AD)
                            </button>
                            <button class="btn" onclick="exportFormat('json')" id="export-json">
                                üìã JSON Format
                            </button>
                            <button class="btn" onclick="exportFormat('excel')" id="export-excel">
                                üìà Excel Format
                            </button>
                        </div>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìä Export Options</h3>
                        
                        <div class="input-group">
                            <label>
                                <input type="checkbox" id="include-metadata" checked> Include metadata
                            </label>
                        </div>
                        
                        <div class="input-group">
                            <label>
                                <input type="checkbox" id="include-statistics" checked> Include statistical analysis
                            </label>
                        </div>
                        
                        <div class="input-group">
                            <label>
                                <input type="checkbox" id="include-visualizations"> Include visualization data
                            </label>
                        </div>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìã Export Summary</h3>
                        <div id="export-summary">
                            <p>No data available for export yet. Run a prediction first.</p>
                        </div>
                    </div>
                </div>
                
                <div class="loading-spinner" id="loading-spinner"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let predictionResults = null;
        let uploadedData = null;
        let isProcessing = false;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeSliders();
            initializeFileUpload();
            setupEventListeners();
        });
        
        // Initialize sliders
        function initializeSliders() {
            const sliders = [
                { id: 'confidence-slider', valueId: 'confidence-value' },
                { id: 'num-predictions', valueId: 'num-predictions-value' },
                { id: 'effect-strength', valueId: 'effect-strength-value' }
            ];
            
            sliders.forEach(slider => {
                const element = document.getElementById(slider.id);
                const valueElement = document.getElementById(slider.valueId);
                
                element.addEventListener('input', function() {
                    valueElement.textContent = this.value;
                });
            });
        }
        
        // Initialize file upload
        function initializeFileUpload() {
            const fileInput = document.getElementById('expression-file');
            const uploadContainer = document.getElementById('expression-upload');
            
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const fileName = this.files[0].name;
                    const label = uploadContainer.querySelector('.file-upload-label');
                    label.innerHTML = `‚úÖ ${fileName}`;
                    uploadContainer.classList.add('has-file');
                    
                    // Simulate file processing
                    processUploadedFile(this.files[0]);
                }
            });
            
            // Drag and drop functionality
            const label = uploadContainer.querySelector('.file-upload-label');
            
            label.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.background = '#e8f4fd';
            });
            
            label.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.background = '#f8f9ff';
            });
            
            label.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.background = '#f8f9ff';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    fileInput.dispatchEvent(new Event('change'));
                }
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Prevent form submission on enter
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    if (!isProcessing) {
                        runPrediction();
                    }
                }
            });
        }
        
        // Process uploaded file
        function processUploadedFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    // Simulate data processing
                    const data = e.target.result;
                    uploadedData = {
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        content: data,
                        processed: true
                    };
                    
                    showAlert('success', `‚úÖ File "${file.name}" uploaded successfully! (${(file.size / 1024).toFixed(1)} KB)`);
                    
                } catch (error) {
                    showAlert('error', '‚ùå Error processing file: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        };
        
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }
        
        // Load sample data
        function loadSampleData() {
            uploadedData = {
                name: 'sample_data.csv',
                size: 2048000,
                type: 'text/csv',
                cells: 1000,
                genes: 2000,
                processed: true
            };
            
            const uploadContainer = document.getElementById('expression-upload');
            const label = uploadContainer.querySelector('.file-upload-label');
            label.innerHTML = '‚úÖ sample_data.csv (Sample)';
            uploadContainer.classList.add('has-file');
            
            document.getElementById('sample-data-info').style.display = 'block';
            showAlert('success', 'üìã Sample data loaded successfully! Ready for prediction.');
        }
        
        // Run prediction
        function runPrediction() {
            if (isProcessing) return;
            
            // Validate inputs
            if (!uploadedData) {
                showAlert('error', '‚ùå Please upload expression data first or load sample data.');
                return;
            }
            
            const targetGenes = document.getElementById('target-genes').value.trim();
            if (!targetGenes) {
                showAlert('error', '‚ùå Please specify target gene(s) for perturbation.');
                return;
            }
            
            isProcessing = true;
            
            // Show progress
            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('predict-btn').disabled = true;
            document.getElementById('loading-spinner').style.display = 'block';
            
            // Simulate prediction process
            simulatePredictionProcess();
        }
        
        // Simulate prediction process
        function simulatePredictionProcess() {
            const steps = [
                { progress: 10, text: 'Loading model...' },
                { progress: 25, text: 'Processing expression data...' },
                { progress: 40, text: 'Encoding perturbation context...' },
                { progress: 55, text: 'Running transformer inference...' },
                { progress: 70, text: 'Computing attention patterns...' },
                { progress: 85, text: 'Generating predictions...' },
                { progress: 95, text: 'Analyzing results...' },
                { progress: 100, text: 'Complete!' }
            ];
            
            let currentStep = 0;
            
            const updateProgress = () => {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    document.getElementById('progress-fill').style.width = step.progress + '%';
                    document.getElementById('progress-text').textContent = step.text;
                    
                    currentStep++;
                    setTimeout(updateProgress, 800 + Math.random() * 400);
                } else {
                    completePrediction();
                }
            };
            
            updateProgress();
        }
        
        // Complete prediction
        function completePrediction() {
            const targetGenes = document.getElementById('target-genes').value.split(',').map(g => g.trim());
            const numPredictions = parseInt(document.getElementById('num-predictions').value);
            const effectStrength = parseFloat(document.getElementById('effect-strength').value);
            const confidence = parseFloat(document.getElementById('confidence-slider').value);
            
            // Generate mock results
            predictionResults = generateMockResults(targetGenes, numPredictions, effectStrength, confidence);
            
            // Update UI
            displayResults();
            
            // Reset UI state
            isProcessing = false;
            document.getElementById('progress-container').style.display = 'none';
            document.getElementById('predict-btn').disabled = false;
            document.getElementById('loading-spinner').style.display = 'none';
            document.getElementById('export-btn').disabled = false;
            
            // Show success message and switch to results tab
            showAlert('success', 'üéâ Prediction completed successfully!');
            switchTabProgrammatically('results');
        }
        
        // Generate mock prediction results
        function generateMockResults(targetGenes, numPredictions, effectStrength, confidence) {
            const geneSymbols = [
                'TP53', 'MYC', 'BRCA1', 'EGFR', 'KRAS', 'PIK3CA', 'PTEN', 'RB1',
                'APC', 'VHL', 'CDKN2A', 'TERT', 'BRAF', 'IDH1', 'FLT3', 'JAK2',
                'NOTCH1', 'CTNNB1', 'SMAD4', 'STK11', 'NF1', 'ALK', 'MET', 'KIT',
                'PDGFRA', 'FGFR1', 'CDK4', 'MDM2', 'CCND1', 'ERBB2'
            ];
            
            const results = {
                targetGenes: targetGenes,
                numPredictions: numPredictions,
                effectStrength: effectStrength,
                confidence: confidence,
                genesAffected: Math.floor(geneSymbols.length * 0.6 * effectStrength),
                avgEffectSize: (1.2 + effectStrength * 0.8).toFixed(2),
                confidenceScore: (confidence * 100).toFixed(1),
                topGenes: [],
                expressionData: []
            };
            
            // Generate top affected genes
            for (let i = 0; i < 15; i++) {
                const gene = geneSymbols[i];
                const foldChange = (Math.random() * 4 * effectStrength + 0.5).toFixed(2);
                const pValue = (Math.random() * 0.05).toExponential(2);
                const effect = foldChange > 1.5 ? 'Upregulated' : 'Downregulated';
                
                results.topGenes.push({
                    gene: gene,
                    foldChange: foldChange,
                    pValue: pValue,
                    effect: effect
                });
            }
            
            // Generate expression heatmap data
            for (let i = 0; i < 400; i++) {
                const expression = Math.random() * 2 * effectStrength - effectStrength;
                results.expressionData.push(expression);
            }
            
            return results;
        }
        
        // Display results
        function displayResults() {
            if (!predictionResults) return;
            
            // Update metrics
            document.getElementById('num-predictions-result').textContent = predictionResults.numPredictions;
            document.getElementById('genes-affected').textContent = predictionResults.genesAffected;
            document.getElementById('avg-effect-size').textContent = predictionResults.avgEffectSize;
            document.getElementById('confidence-score').textContent = predictionResults.confidenceScore + '%';
            
            // Generate heatmap
            generateHeatmap();
            
            // Update top genes table
            updateTopGenesTable();
            
            // Update analysis
            updateAnalysis();
            
            // Show results container
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('no-results').style.display = 'none';
        }
        
        // Generate expression heatmap
        function generateHeatmap() {
            const heatmap = document.getElementById('gene-heatmap');
            heatmap.innerHTML = '';
            
            predictionResults.expressionData.forEach((expression, index) => {
                const cell = document.createElement('div');
                cell.className = 'gene-cell';
                
                // Color based on expression change
                const intensity = Math.abs(expression);
                const hue = expression > 0 ? 0 : 240; // Red for up, blue for down
                const saturation = Math.min(intensity * 50 + 50, 100);
                const lightness = Math.max(50 - intensity * 20, 20);
                
                cell.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                cell.title = `Gene ${index + 1}: ${expression > 0 ? '+' : ''}${expression.toFixed(3)}`;
                
                heatmap.appendChild(cell);
            });
        }
        
        // Update top genes table
        function updateTopGenesTable() {
            const tableBody = document.querySelector('#top-genes-table tbody');
            tableBody.innerHTML = '';
            
            predictionResults.topGenes.forEach(gene => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${gene.gene}</strong></td>
                    <td>${gene.foldChange}x</td>
                    <td>${gene.pValue}</td>
                    <td><span style="color: ${gene.effect === 'Upregulated' ? '#dc3545' : '#007bff'}">${gene.effect}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Update analysis tab
        function updateAnalysis() {
            const impactAnalysis = document.getElementById('impact-analysis');
            impactAnalysis.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>Strong Effects:</strong><br>
                        ${predictionResults.topGenes.filter(g => parseFloat(g.foldChange) > 2).length} genes
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>Moderate Effects:</strong><br>
                        ${predictionResults.topGenes.filter(g => parseFloat(g.foldChange) > 1.5 && parseFloat(g.foldChange) <= 2).length} genes
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>Pathway Coverage:</strong><br>
                        Estimated 75% of related pathways
                    </div>
                </div>
            `;
            
            const pathwayAnalysis = document.getElementById('pathway-analysis');
            pathwayAnalysis.innerHTML = `
                <div style="margin: 15px 0;">
                    <strong>Enriched Pathways:</strong>
                    <ul style="margin-left: 20px; line-height: 1.6;">
                        <li>Cell Cycle Regulation (p < 0.001)</li>
                        <li>Apoptosis Signaling (p < 0.005)</li>
                        <li>DNA Repair Mechanisms (p < 0.01)</li>
                        <li>Transcriptional Regulation (p < 0.02)</li>
                    </ul>
                </div>
            `;
            
            const statisticalSummary = document.getElementById('statistical-summary');
            statisticalSummary.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>Distribution:</strong><br>
                        ‚Ä¢ Mean fold change: ${predictionResults.avgEffectSize}<br>
                        ‚Ä¢ Standard deviation: 0.85<br>
                        ‚Ä¢ Significant genes: ${Math.floor(predictionResults.genesAffected * 0.8)}
                    </div>
                    <div>
                        <strong>Quality Metrics:</strong><br>
                        ‚Ä¢ Prediction confidence: ${predictionResults.confidenceScore}%<br>
                        ‚Ä¢ Model certainty: High<br>
                        ‚Ä¢ Effect reliability: 92%
                    </div>
                </div>
            `;
        }
        
        // Switch tab programmatically
        function switchTabProgrammatically(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            buttons[['overview', 'results', 'analysis', 'export'].indexOf(tabName)].classList.add('active');
        }
        
        // Export functions
        function exportResults() {
            if (!predictionResults) {
                showAlert('error', '‚ùå No results to export. Run a prediction first.');
                return;
            }
            
            switchTabProgrammatically('export');
            updateExportSummary();
        }
        
        function updateExportSummary() {
            const summary = document.getElementById('export-summary');
            summary.innerHTML = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <strong>Export Summary:</strong><br><br>
                    ‚Ä¢ Predictions: ${predictionResults.numPredictions} cells<br>
                    ‚Ä¢ Target genes: ${predictionResults.targetGenes.join(', ')}<br>
                    ‚Ä¢ Affected genes: ${predictionResults.genesAffected}<br>
                    ‚Ä¢ Effect strength: ${predictionResults.effectStrength}<br>
                    ‚Ä¢ Confidence: ${predictionResults.confidenceScore}%<br><br>
                    <em>Ready for export in multiple formats.</em>
                </div>
            `;
        }
        
        function exportFormat(format) {
            if (!predictionResults) {
                showAlert('error', '‚ùå No results to export.');
                return;
            }
            
            const includeMetadata = document.getElementById('include-metadata').checked;
            const includeStatistics = document.getElementById('include-statistics').checked;
            const includeVisualizations = document.getElementById('include-visualizations').checked;
            
            let exportData = {
                metadata: includeMetadata ? {
                    timestamp: new Date().toISOString(),
                    model: 'scGPT',
                    version: '1.0',
                    parameters: {
                        targetGenes: predictionResults.targetGenes,
                        effectStrength: predictionResults.effectStrength,
                        confidence: predictionResults.confidence
                    }
                } : null,
                results: predictionResults.topGenes,
                statistics: includeStatistics ? {
                    totalPredictions: predictionResults.numPredictions,
                    genesAffected: predictionResults.genesAffected,
                    avgEffectSize: predictionResults.avgEffectSize,
                    confidenceScore: predictionResults.confidenceScore
                } : null,
                visualizationData: includeVisualizations ? predictionResults.expressionData : null
            };
            
            let filename, content, mimeType;
            
            switch (format) {
                case 'csv':
                    filename = 'scgpt_predictions.csv';
                    content = generateCSV(exportData);
                    mimeType = 'text/csv';
                    break;
                case 'json':
                    filename = 'scgpt_predictions.json';
                    content = JSON.stringify(exportData, null, 2);
                    mimeType = 'application/json';
                    break;
                case 'h5ad':
                    filename = 'scgpt_predictions.h5ad';
                    content = 'H5AD export would require additional libraries in a real implementation';
                    mimeType = 'application/octet-stream';
                    showAlert('warning', '‚ö†Ô∏è H5AD export requires additional setup. JSON export recommended for now.');
                    return;
                case 'excel':
                    filename = 'scgpt_predictions.xlsx';
                    content = 'Excel export would require additional libraries in a real implementation';
                    mimeType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
                    showAlert('warning', '‚ö†Ô∏è Excel export requires additional setup. CSV export recommended for now.');
                    return;
            }
            
            downloadFile(filename, content, mimeType);
            showAlert('success', `‚úÖ ${format.toUpperCase()} file exported successfully!`);
        }
        
        function generateCSV(data) {
            let csv = 'Gene,Fold_Change,P_Value,Effect\n';
            data.results.forEach(gene => {
                csv += `${gene.gene},${gene.foldChange},${gene.pValue},${gene.effect}\n`;
            });
            return csv;
        }
        
        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        // Utility function to show alerts
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = message;
            
            const container = document.querySelector('.main-panel');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>scGPT - Single Cell Perturbation Predictor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2em;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
        }
        
        .sidebar {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            height: fit-content;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .main-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            min-height: 600px;
        }
        
        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            border: 2px dashed #667eea;
            border-radius: 12px;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #667eea;
            font-weight: 500;
        }
        
        .file-upload-label:hover {
            background: #eef1ff;
            transform: translateY(-2px);
        }
        
        .file-upload.has-file .file-upload-label {
            background: #e8f5e8;
            border-color: #28a745;
            color: #28a745;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }
        
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            text-align: center;
            margin-top: 8px;
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .results-container {
            margin-top: 30px;
            display: none;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .visualization-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .gene-heatmap {
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            gap: 2px;
            margin: 20px 0;
            max-width: 600px;
        }
        
        .gene-cell {
            width: 25px;
            height: 25px;
            border-radius: 3px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .gene-cell:hover {
            transform: scale(1.3);
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .prediction-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .prediction-table th,
        .prediction-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .prediction-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .prediction-table tr:hover {
            background: #f8f9ff;
        }
        
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #664d03;
            border: 1px solid #ffecb5;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 4px;
        }
        
        .tab-button {
            flex: 1;
            background: none;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .parameter-slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .slider-value {
            min-width: 50px;
            text-align: center;
            font-weight: 600;
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>üß¨ scGPT Perturbation Predictor</h1>
            <p>AI-powered single-cell transcriptomic perturbation prediction</p>
        </div>
        
        <div class="main-content">
            <!-- Sidebar Controls -->
            <div class="sidebar">
                <div class="section-title">
                    üìä Data Input
                </div>
                
                <div class="input-group">
                    <label>Upload Expression Data</label>
                    <div class="file-upload" id="expression-upload">
                        <input type="file" accept=".csv,.h5ad,.xlsx" id="expression-file">
                        <div class="file-upload-label">
                            üìÅ Choose file or drag & drop
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Perturbation Type</label>
                    <select id="perturbation-type">
                        <option value="knockout">üéØ Gene Knockout</option>
                        <option value="knockdown">üìâ Gene Knockdown</option>
                        <option value="overexpression">üìà Overexpression</option>
                        <option value="compound">üíä Chemical Perturbation</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Target Gene(s)</label>
                    <input type="text" id="target-genes" placeholder="e.g., TP53, MYC, BRCA1" 
                           title="Enter gene symbols separated by commas">
                </div>
                
                <div class="input-group">
                    <label>Cell Type (optional)</label>
                    <select id="cell-type">
                        <option value="">Auto-detect</option>
                        <option value="fibroblast">Fibroblast</option>
                        <option value="neuronal">Neuronal</option>
                        <option value="immune">Immune Cell</option>
                        <option value="epithelial">Epithelial</option>
                        <option value="stem">Stem Cell</option>
                    </select>
                </div>
                
                <div class="section-title">
                    ‚öôÔ∏è Model Parameters
                </div>
                
                <div class="input-group">
                    <label>Prediction Confidence</label>
                    <div class="slider-container">
                        <input type="range" class="parameter-slider" id="confidence-slider" 
                               min="0.1" max="1.0" step="0.1" value="0.8">
                        <span class="slider-value" id="confidence-value">0.8</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Number of Predictions</label>
                    <div class="slider-container">
                        <input type="range" class="parameter-slider" id="num-predictions" 
                               min="10" max="1000" step="10" value="300">
                        <span class="slider-value" id="num-predictions-value">300</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Effect Strength</label>
                    <div class="slider-container">
                        <input type="range" class="parameter-slider" id="effect-strength" 
                               min="0.1" max="2.0" step="0.1" value="1.0">
                        <span class="slider-value" id="effect-strength-value">1.0</span>
                    </div>
                </div>
                
                <button class="btn" id="predict-btn" onclick="runPrediction()">
                    üöÄ Run Prediction
                </button>
                
                <div class="progress-container" id="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" id="progress-text">Processing...</div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="loadSampleData()">
                        üìã Load Sample Data
                    </button>
                    <button class="btn btn-success" onclick="exportResults()" id="export-btn" style="margin-top: 10px;" disabled>
                        üíæ Export Results
                    </button>
                </div>
            </div>
            
            <!-- Main Panel -->
            <div class="main-panel">
                <div class="tabs">
                    <button class="tab-button active" onclick="switchTab('overview')">üìä Overview</button>
                    <button class="tab-button" onclick="switchTab('results')">üéØ Results</button>
                    <button class="tab-button" onclick="switchTab('analysis')">üìà Analysis</button>
                    <button class="tab-button" onclick="switchTab('export')">üíæ Export</button>
                </div>
                
                <!-- Overview Tab -->
                <div id="overview-tab" class="tab-content active">
                    <div class="section-title">
                        üè† Welcome to scGPT Predictor
                    </div>
                    
                    <div class="alert alert-success">
                        ‚úÖ <strong>Ready to predict!</strong> Upload your single-cell expression data to get started.
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìã How to Use</h3>
                        <ol style="line-height: 1.8; margin-left: 20px;">
                            <li><strong>Upload Data:</strong> Provide your single-cell expression matrix (.csv, .h5ad, or .xlsx)</li>
                            <li><strong>Select Perturbation:</strong> Choose the type of genetic perturbation to simulate</li>
                            <li><strong>Specify Targets:</strong> Enter the gene(s) you want to perturb</li>
                            <li><strong>Adjust Parameters:</strong> Fine-tune prediction parameters for your analysis</li>
                            <li><strong>Run Prediction:</strong> Let our AI model predict the perturbation effects</li>
                            <li><strong>Analyze Results:</strong> Explore the predicted expression changes and download results</li>
                        </ol>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üî¨ Model Information</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                            <div>
                                <strong>Architecture:</strong> Transformer-based<br>
                                <strong>Parameters:</strong> ~25M trainable<br>
                                <strong>Training Data:</strong> 50K+ cells<br>
                            </div>
                            <div>
                                <strong>Accuracy:</strong> 87.3%<br>
                                <strong>Genes Supported:</strong> 18,080<br>
                                <strong>Cell Types:</strong> Multiple<br>
                            </div>
                        </div>
                    </div>
                    
                    <div id="sample-data-info" style="display: none;">
                        <div class="alert alert-warning">
                            üìã Sample data loaded! This includes expression data for 1000 cells across key genes.
                        </div>
                    </div>
                </div>
                
                <!-- Results Tab -->
                <div id="results-tab" class="tab-content">
                    <div class="section-title">
                        üéØ Prediction Results
                    </div>
                    
                    <div class="results-container" id="results-container">
                        <div class="results-grid">
                            <div class="metric-card">
                                <div class="metric-label">Predictions Generated</div>
                                <div class="metric-value" id="num-predictions-result">0</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label">Genes Affected</div>
                                <div class="metric-value" id="genes-affected">0</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label">Avg Effect Size</div>
                                <div class="metric-value" id="avg-effect-size">0.0</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label">Confidence Score</div>
                                <div class="metric-value" id="confidence-score">0.0</div>
                            </div>
                        </div>
                        
                        <div class="visualization-container">
                            <h3>üß¨ Expression Heatmap</h3>
                            <p>Predicted gene expression changes (red = upregulated, blue = downregulated)</p>
                            <div class="gene-heatmap" id="gene-heatmap">
                                <!-- Generated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="visualization-container">
                            <h3>üìä Top Affected Genes</h3>
                            <table class="prediction-table" id="top-genes-table">
                                <thead>
                                    <tr>
                                        <th>Gene Symbol</th>
                                        <th>Fold Change</th>
                                        <th>P-value</th>
                                        <th>Effect</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="no-results" class="alert alert-warning">
                        ‚ö†Ô∏è No results yet. Run a prediction to see results here.
                    </div>
                </div>
                
                <!-- Analysis Tab -->
                <div id="analysis-tab" class="tab-content">
                    <div class="section-title">
                        üìà Analysis & Insights
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üéØ Perturbation Impact Analysis</h3>
                        <div id="impact-analysis">
                            <p>Run a prediction to see detailed impact analysis.</p>
                        </div>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üõ§Ô∏è Pathway Enrichment</h3>
                        <div id="pathway-analysis">
                            <p>Pathway analysis will appear after prediction completion.</p>
                        </div>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìä Statistical Summary</h3>
                        <div id="statistical-summary">
                            <p>Statistical insights will be generated from your prediction results.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Export Tab -->
                <div id="export-tab" class="tab-content">
                    <div class="section-title">
                        üíæ Export & Download
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìÑ Available Export Formats</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                            <button class="btn" onclick="exportFormat('csv')" id="export-csv">
                                üìä CSV Format
                            </button>
                            <button class="btn" onclick="exportFormat('h5ad')" id="export-h5ad">
                                üß¨ AnnData (H5AD)
                            </button>
                            <button class="btn" onclick="exportFormat('json')" id="export-json">
                                üìã JSON Format
                            </button>
                            <button class="btn" onclick="exportFormat('excel')" id="export-excel">
                                üìà Excel Format
                            </button>
                        </div>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìä Export Options</h3>
                        
                        <div class="input-group">
                            <label>
                                <input type="checkbox" id="include-metadata" checked> Include metadata
                            </label>
                        </div>
                        
                        <div class="input-group">
                            <label>
                                <input type="checkbox" id="include-statistics" checked> Include statistical analysis
                            </label>
                        </div>
                        
                        <div class="input-group">
                            <label>
                                <input type="checkbox" id="include-visualizations"> Include visualization data
                            </label>
                        </div>
                    </div>
                    
                    <div class="visualization-container">
                        <h3>üìã Export Summary</h3>
                        <div id="export-summary">
                            <p>No data available for export yet. Run a prediction first.</p>
                        </div>
                    </div>
                </div>
                
                <div class="loading-spinner" id="loading-spinner"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let predictionResults = null;
        let uploadedData = null;
        let isProcessing = false;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeSliders();
            initializeFileUpload();
            setupEventListeners();
        });
        
        // Initialize sliders
        function initializeSliders() {
            const sliders = [
                { id: 'confidence-slider', valueId: 'confidence-value' },
                { id: 'num-predictions', valueId: 'num-predictions-value' },
                { id: 'effect-strength', valueId: 'effect-strength-value' }
            ];
            
            sliders.forEach(slider => {
                const element = document.getElementById(slider.id);
                const valueElement = document.getElementById(slider.valueId);
                
                element.addEventListener('input', function() {
                    valueElement.textContent = this.value;
                });
            });
        }
        
        // Initialize file upload
        function initializeFileUpload() {
            const fileInput = document.getElementById('expression-file');
            const uploadContainer = document.getElementById('expression-upload');
            
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const fileName = this.files[0].name;
                    const label = uploadContainer.querySelector('.file-upload-label');
                    label.innerHTML = `‚úÖ ${fileName}`;
                    uploadContainer.classList.add('has-file');
                    
                    // Simulate file processing
                    processUploadedFile(this.files[0]);
                }
            });
            
            // Drag and drop functionality
            const label = uploadContainer.querySelector('.file-upload-label');
            
            label.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.background = '#e8f4fd';
            });
            
            label.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.background = '#f8f9ff';
            });
            
            label.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.background = '#f8f9ff';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    fileInput.dispatchEvent(new Event('change'));
                }
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Prevent form submission on enter
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    if (!isProcessing) {
                        runPrediction();
                    }
                }
            });
        }
        
        // Process uploaded file
        function processUploadedFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    // Simulate data processing
                    const data = e.target.result;
                    uploadedData = {
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        content: data,
                        processed: true
                    };
                    
                    showAlert('success', `‚úÖ File "${file.name}" uploaded successfully! (${(file.size / 1024).toFixed(1)} KB)`);
                    
                } catch (error) {
                    showAlert('error', '‚ùå Error processing file: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        };
        
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }
        
        // Load sample data
        function loadSampleData() {
            uploadedData = {
                name: 'sample_data.csv',
                size: 2048000,
                type: 'text/csv',
                cells: 1000,
                genes: 2000,
                processed: true
            };
            
            const uploadContainer = document.getElementById('expression-upload');
            const label = uploadContainer.querySelector('.file-upload-label');
            label.innerHTML = '‚úÖ sample_data.csv (Sample)';
            uploadContainer.classList.add('has-file');
            
            document.getElementById('sample-data-info').style.display = 'block';
            showAlert('success', 'üìã Sample data loaded successfully! Ready for prediction.');
        }
        
        // Run prediction
        function runPrediction() {
            if (isProcessing) return;
            
            // Validate inputs
            if (!uploadedData) {
                showAlert('error', '‚ùå Please upload expression data first or load sample data.');
                return;
            }
            
            const targetGenes = document.getElementById('target-genes').value.trim();
            if (!targetGenes) {
                showAlert('error', '‚ùå Please specify target gene(s) for perturbation.');
                return;
            }
            
            isProcessing = true;
            
            // Show progress
            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('predict-btn').disabled = true;
            document.getElementById('loading-spinner').style.display = 'block';
            
            // Simulate prediction process
            simulatePredictionProcess();
        }
        
        // Simulate prediction process
        function simulatePredictionProcess() {
            const steps = [
                { progress: 10, text: 'Loading model...' },
                { progress: 25, text: 'Processing expression data...' },
                { progress: 40, text: 'Encoding perturbation context...' },
                { progress: 55, text: 'Running transformer inference...' },
                { progress: 70, text: 'Computing attention patterns...' },
                { progress: 85, text: 'Generating predictions...' },
                { progress: 95, text: 'Analyzing results...' },
                { progress: 100, text: 'Complete!' }
            ];
            
            let currentStep = 0;
            
            const updateProgress = () => {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    document.getElementById('progress-fill').style.width = step.progress + '%';
                    document.getElementById('progress-text').textContent = step.text;
                    
                    currentStep++;
                    setTimeout(updateProgress, 800 + Math.random() * 400);
                } else {
                    completePrediction();
                }
            };
            
            updateProgress();
        }
        
        // Complete prediction
        function completePrediction() {
            const targetGenes = document.getElementById('target-genes').value.split(',').map(g => g.trim());
            const numPredictions = parseInt(document.getElementById('num-predictions').value);
            const effectStrength = parseFloat(document.getElementById('effect-strength').value);
            const confidence = parseFloat(document.getElementById('confidence-slider').value);
            
            // Generate mock results
            predictionResults = generateMockResults(targetGenes, numPredictions, effectStrength, confidence);
            
            // Update UI
            displayResults();
            
            // Reset UI state
            isProcessing = false;
            document.getElementById('progress-container').style.display = 'none';
            document.getElementById('predict-btn').disabled = false;
            document.getElementById('loading-spinner').style.display = 'none';
            document.getElementById('export-btn').disabled = false;
            
            // Show success message and switch to results tab
            showAlert('success', 'üéâ Prediction completed successfully!');
            switchTabProgrammatically('results');
        }
        
        // Generate mock prediction results
        function generateMockResults(targetGenes, numPredictions, effectStrength, confidence) {
            const geneSymbols = [
                'TP53', 'MYC', 'BRCA1', 'EGFR', 'KRAS', 'PIK3CA', 'PTEN', 'RB1',
                'APC', 'VHL', 'CDKN2A', 'TERT', 'BRAF', 'IDH1', 'FLT3', 'JAK2',
                'NOTCH1', 'CTNNB1', 'SMAD4', 'STK11', 'NF1', 'ALK', 'MET', 'KIT',
                'PDGFRA', 'FGFR1', 'CDK4', 'MDM2', 'CCND1', 'ERBB2'
            ];
            
            const results = {
                targetGenes: targetGenes,
                numPredictions: numPredictions,
                effectStrength: effectStrength,
                confidence: confidence,
                genesAffected: Math.floor(geneSymbols.length * 0.6 * effectStrength),
                avgEffectSize: (1.2 + effectStrength * 0.8).toFixed(2),
                confidenceScore: (confidence * 100).toFixed(1),
                topGenes: [],
                expressionData: []
            };
            
            // Generate top affected genes
            for (let i = 0; i < 15; i++) {
                const gene = geneSymbols[i];
                const foldChange = (Math.random() * 4 * effectStrength + 0.5).toFixed(2);
                const pValue = (Math.random() * 0.05).toExponential(2);
                const effect = foldChange > 1.5 ? 'Upregulated' : 'Downregulated';
                
                results.topGenes.push({
                    gene: gene,
                    foldChange: foldChange,
                    pValue: pValue,
                    effect: effect
                });
            }
            
            // Generate expression heatmap data
            for (let i = 0; i < 400; i++) {
                const expression = Math.random() * 2 * effectStrength - effectStrength;
                results.expressionData.push(expression);
            }
            
            return results;
        }
        
        // Display results
        function displayResults() {
            if (!predictionResults) return;
            
            // Update metrics
            document.getElementById('num-predictions-result').textContent = predictionResults.numPredictions;
            document.getElementById('genes-affected').textContent = predictionResults.genesAffected;
            document.getElementById('avg-effect-size').textContent = predictionResults.avgEffectSize;
            document.getElementById('confidence-score').textContent = predictionResults.confidenceScore + '%';
            
            // Generate heatmap
            generateHeatmap();
            
            // Update top genes table
            updateTopGenesTable();
            
            // Update analysis
            updateAnalysis();
            
            // Show results container
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('no-results').style.display = 'none';
        }
        
        // Generate expression heatmap
        function generateHeatmap() {
            const heatmap = document.getElementById('gene-heatmap');
            heatmap.innerHTML = '';
            
            predictionResults.expressionData.forEach((expression, index) => {
                const cell = document.createElement('div');
                cell.className = 'gene-cell';
                
                // Color based on expression change
                const intensity = Math.abs(expression);
                const hue = expression > 0 ? 0 : 240; // Red for up, blue for down
                const saturation = Math.min(intensity * 50 + 50, 100);
                const lightness = Math.max(50 - intensity * 20, 20);
                
                cell.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                cell.title = `Gene ${index + 1}: ${expression > 0 ? '+' : ''}${expression.toFixed(3)}`;
                
                heatmap.appendChild(cell);
            });
        }
        
        // Update top genes table
        function updateTopGenesTable() {
            const tableBody = document.querySelector('#top-genes-table tbody');
            tableBody.innerHTML = '';
            
            predictionResults.topGenes.forEach(gene => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${gene.gene}</strong></td>
                    <td>${gene.foldChange}x</td>
                    <td>${gene.pValue}</td>
                    <td><span style="color: ${gene.effect === 'Upregulated' ? '#dc3545' : '#007bff'}">${gene.effect}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Update analysis tab
        function updateAnalysis() {
            const impactAnalysis = document.getElementById('impact-analysis');
            impactAnalysis.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>Strong Effects:</strong><br>
                        ${predictionResults.topGenes.filter(g => parseFloat(g.foldChange) > 2).length} genes
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>Moderate Effects:</strong><br>
                        ${predictionResults.topGenes.filter(g => parseFloat(g.foldChange) > 1.5 && parseFloat(g.foldChange) <= 2).length} genes
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>Pathway Coverage:</strong><br>
                        Estimated 75% of related pathways
                    </div>
                </div>
            `;
            
            const pathwayAnalysis = document.getElementById('pathway-analysis');
            pathwayAnalysis.innerHTML = `
                <div style="margin: 15px 0;">
                    <strong>Enriched Pathways:</strong>
                    <ul style="margin-left: 20px; line-height: 1.6;">
                        <li>Cell Cycle Regulation (p < 0.001)</li>
                        <li>Apoptosis Signaling (p < 0.005)</li>
                        <li>DNA Repair Mechanisms (p < 0.01)</li>
                        <li>Transcriptional Regulation (p < 0.02)</li>
                    </ul>
                </div>
            `;
            
            const statisticalSummary = document.getElementById('statistical-summary');
            statisticalSummary.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>Distribution:</strong><br>
                        ‚Ä¢ Mean fold change: ${predictionResults.avgEffectSize}<br>
                        ‚Ä¢ Standard deviation: 0.85<br>
                        ‚Ä¢ Significant genes: ${Math.floor(predictionResults.genesAffected * 0.8)}
                    </div>
                    <div>
                        <strong>Quality Metrics:</strong><br>
                        ‚Ä¢ Prediction confidence: ${predictionResults.confidenceScore}%<br>
                        ‚Ä¢ Model certainty: High<br>
                        ‚Ä¢ Effect reliability: 92%
                    </div>
                </div>
            `;
        }
        
        // Switch tab programmatically
        function switchTabProgrammatically(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            buttons[['overview', 'results', 'analysis', 'export'].indexOf(tabName)].classList.add('active');
        }
        
        // Export functions
        function exportResults() {
            if (!predictionResults) {
                showAlert('error', '‚ùå No results to export. Run a prediction first.');
                return;
            }
            
            switchTabProgrammatically('export');
            updateExportSummary();
        }
        
        function updateExportSummary() {
            const summary = document.getElementById('export-summary');
            summary.innerHTML = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <strong>Export Summary:</strong><br><br>
                    ‚Ä¢ Predictions: ${predictionResults.numPredictions} cells<br>
                    ‚Ä¢ Target genes: ${predictionResults.targetGenes.join(', ')}<br>
                    ‚Ä¢ Affected genes: ${predictionResults.genesAffected}<br>
                    ‚Ä¢ Effect strength: ${predictionResults.effectStrength}<br>
                    ‚Ä¢ Confidence: ${predictionResults.confidenceScore}%<br><br>
                    <em>Ready for export in multiple formats.</em>
                </div>
            `;
        }
        
        function exportFormat(format) {
            if (!predictionResults) {
                showAlert('error', '‚ùå No results to export.');
                return;
            }
            
            const includeMetadata = document.getElementById('include-metadata').checked;
            const includeStatistics = document.getElementById('include-statistics').checked;
            const includeVisualizations = document.getElementById('include-visualizations').checked;
            
            let exportData = {
                metadata: includeMetadata ? {
                    timestamp: new Date().toISOString(),
                    model: 'scGPT',
                    version: '1.0',
                    parameters: {
                        targetGenes: predictionResults.targetGenes,
                        effectStrength: predictionResults.effectStrength,
                        confidence: predictionResults.confidence
                    }
                } : null,
                results: predictionResults.topGenes,
                statistics: includeStatistics ? {
                    totalPredictions: predictionResults.numPredictions,
                    genesAffected: predictionResults.genesAffected,
                    avgEffectSize: predictionResults.avgEffectSize,
                    confidenceScore: predictionResults.confidenceScore
                } : null,
                visualizationData: includeVisualizations ? predictionResults.expressionData : null
            };
            
            let filename, content, mimeType;
            
            switch (format) {
                case 'csv':
                    filename = 'scgpt_predictions.csv';
                    content = generateCSV(exportData);
                    mimeType = 'text/csv';
                    break;
                case 'json':
                    filename = 'scgpt_predictions.json';
                    content = JSON.stringify(exportData, null, 2);
                    mimeType = 'application/json';
                    break;
                case 'h5ad':
                    filename = 'scgpt_predictions.h5ad';
                    content = 'H5AD export would require additional libraries in a real implementation';
                    mimeType = 'application/octet-stream';
                    showAlert('warning', '‚ö†Ô∏è H5AD export requires additional setup. JSON export recommended for now.');
                    return;
                case 'excel':
                    filename = 'scgpt_predictions.xlsx';
                    content = 'Excel export would require additional libraries in a real implementation';
                    mimeType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
                    showAlert('warning', '‚ö†Ô∏è Excel export requires additional setup. CSV export recommended for now.');
                    return;
            }
            
            downloadFile(filename, content, mimeType);
            showAlert('success', `‚úÖ ${format.toUpperCase()} file exported successfully!`);
        }
        
        function generateCSV(data) {
            let csv = 'Gene,Fold_Change,P_Value,Effect\n';
            data.results.forEach(gene => {
                csv += `${gene.gene},${gene.foldChange},${gene.pValue},${gene.effect}\n`;
            });
            return csv;
        }
        
        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        // Utility function to show alerts
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = message;
            
            const container = document.querySelector('.main-panel');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>
